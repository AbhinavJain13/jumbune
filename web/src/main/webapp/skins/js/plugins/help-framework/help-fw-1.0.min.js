/*
* Help Framework 1.0
* 
* Copyright 2012, Impetus
* 
* Date: Mon Nov 21 2012 04:05
* 
* Author: Pravin Patidar
*
* Depends:
*	jquery.ui.js
*/

(function(e){e.fn.extend({helpfw:function(t){function S(){e(E).append(s).appendTo("body"),e(E).find(".help-wrap").css({width:r.width,height:r.height,left:c,top:h}).addClass(p);var t=e("<span/>").attr("class","close-help").appendTo(e(E).find(".help-wrap")).click(C)}function x(t){e(E).find(".hf-title h1").html(r.title),e(E).find(".hf-footer-bar").html(r.footer)}function T(){var t=e(E).find(".hf-title").innerHeight(),n=e(E).find(".hf-action-bar").innerHeight(),i=e(E).find(".hf-footer-bar").innerHeight(),s=r.height-(t+n+i);e(E).find(".hf-category-pane").height(s-30),e(E).find(".hf-content-box").height(s)}function N(){o=!0,e(E).css({display:"block"}),k()}function C(){o=!1,e(E).find(".cat-tabs a:first").trigger("click"),e(E).css({display:"none"})}function k(){e(E).find(".cats").find(".obico").removeClass("obico").addClass("bico").end().find("ul").hide(),e(E).find(".cats li:first").find("a:first").trigger("click"),e(E).find("input.hf-search-fld").val("")}function L(){e(E).find(".cats-idx").find("a.act").removeClass("act").end().find("a:first").trigger("click")}function A(t){var n=e('<ul class="cats"/>'),r=0;for(;r<t.length;r++){var i=e("<li/>"),s=e('<a href="javascript:void(0)" class="cat-'+r+'"/>'),o=e("<span/>"),u=e('<span class="lbl"/>');t[r].topics.length>0?function(){e(o).attr("class","bico"),e(u).html(t[r].title),e(s).append(o,u).appendTo(i),P(r,t[r].topics,i)}():function(){e(o).attr("class","fico"),e(u).html(t[r].title),e(s).append(o,u).appendTo(i)},e(n).append(i);var a=t[r].title.substr(0,1);B(a,t[r],r)}e(E).find(".hf-category").html(n)}function O(e){var t={},n,r=[];for(n in e)e.hasOwnProperty(n)&&r.push(n);r.sort();for(n=0;n<r.length;n++)t[r[n]]=e[r[n]];return t}function M(){var t=e('<ul class="cats-idx"/>'),n=O(d[w].indexed);e.each(n,function(n,r){var i=e('<li class="ttl"/>').append("<b>"+n+"</b>");e(t).append(i),e.each(r,function(n,r){var i=e("<li/>"),s=e('<a href="javascript:void(0)" class="idx-'+n+'"/>').html(r.title);e(i).append(s),e(t).append(i)})}),e(E).find(".hf-category-index").html(t).find("a").click(_)}function _(){var t=this.className.split("-")[1];e(E).find(".cats").find(".cat-"+t).trigger("click")}function D(){var t=!1;e(E).find(".cat-tabs a").click(function(){thisId=this.className;var n=e(E).find(".cat-tabs").find("li.act a").attr("class"),r=e(this).attr("ui:target");e(r).css({display:"block"}).siblings("div").css({display:"none"}),e(this).parent("li").addClass("act").siblings("li").removeClass("act"),t==1&&(F(n),F(m),m=n),t=!0}),e(E).find(".cat-tabs a:first").trigger("click")}function P(t,n,r){var i=e("<ul/>"),s=0;for(;s<n.length;s++){var o=e("<li/>"),u=e('<a href="javascript:void(0)" class="cat-'+t+""+s+'"/>'),a=e("<span/>"),f=e('<span class="lbl"/>');n[s].topics.length>0?function(){e(a).attr("class","bico"),e(f).html(n[s].title),e(u).append(a,f).appendTo(o),P(t+""+s,n[s].topics,o)}():function(){e(a).attr("class","fico"),e(f).html(n[s].title),e(u).append(a,f).appendTo(o)}(),e(i).append(o);var l=n[s].title.substr(0,1);B(l,n[s],t+""+s)}e(r).append(i)}function H(){m=this.className;var t=m.split("-")[1],n=e(this),r=e(E).find(".cats").find("a.act").attr("class");typeof r!="undefined"&&(r=r.split("-")[1]),e(E).find(".cats").find("a.act").removeClass("act"),e(this).addClass("act"),e(E).find(".cats-idx").find("a.act").removeClass("act"),e(E).find(".cats-idx").find(".idx-"+t).addClass("act"),n.parents("ul").css({display:"block"}),e(E).find(".cats").find("ul").each(function(){e(this).css({display:"none"}).parent("li").find("span.obico").removeClass("obico").addClass("bico")}),n.parents("li").children("ul").css({display:"block"}).end().children("a").find("span.bico").removeClass("bico").addClass("obico"),e(E).find(".pg-title h3").html(e(this).find("span.lbl").text());var i=e(this).find("span.lbl").text().substr(0,1),s=/^[a-zA-Z]{1}$/i.test(i);i=i.toUpperCase(),t!=r&&(s==1?I(m,i):I(m,"#"))}function B(e,t,n){var r=/^[a-zA-Z]{1}$/i.test(e);e=e.toUpperCase(),r==0&&(e="#"),typeof d[w]["indexed"][e]=="undefined"&&(d[w].indexed[e]=new Object),typeof d[w]["indexed"][e][n]=="undefined"&&(d[w].indexed[e][n]=new Object),d[w].indexed[e][n].title=t.title,d[w].indexed[e][n].data=t.data,d[w].indexed[e][n].isExternal=t.isExternal,d[w].allCategories.push(t.title),d[w].allCategoriesId.push(n)}function j(){var t=0,n=0,r,i=e(E).find(".cat-tabs li.act").find("a").attr("class");i=="contents-tab"?r=".cats":i=="index-tab"?r=".cats-idx":"",e(E).find(r).find("a").each(function(){t++,e(this).hasClass("act")==1&&(n=t)}),this.className=="prev-pg"?function(){n-=2,n>=0&&e(E).find(r).find("a").eq(n).trigger("click")}():this.className=="next-pg"?function(){n<t&&e(E).find(r).find("a").eq(n).trigger("click")}():""}function F(t){t=="back-pg"?function(){g--,g<0&&(g=0),b=!1,e(E).find("a."+y[w][g]).trigger("click"),y[w][g]=="contents-tab"||y[w][g]=="index-tab"?function(){y[w][g]=m,g--,e(E).find("a."+y[w][g]).trigger("click")}():"",b=!0,e(E).find("a.forward-pg").addClass("enable"),y[w][g]=m}():t=="forward-pg"?function(){g++,g>y[w].length-1&&(g=y[w].length-1),b=!1,e(E).find("a."+y[w][g]).trigger("click"),y[w][g]=="contents-tab"||y[w][g]=="index-tab"?function(){y[w][g]=m,g++,e(E).find("a."+y[w][g]).trigger("click")}():"",b=!0,e(E).find("a.back-pg").addClass("enable"),y[w][g]=m}():b==1?function(){e(E).find(".forward-pg").hasClass("enable")==1&&y[w].splice(g+1,y[w].length),y[w].push(t),g=y[w].length-1}():"",g>0?e(E).find("a.back-pg").addClass("enable"):e(E).find("a.back-pg").removeClass("enable"),g<y[w].length-1?e(E).find("a.forward-pg").addClass("enable"):e(E).find("a.forward-pg").removeClass("enable")}function I(t,n){var r,i,s,o,u=t.split("-")[1];F(t),e(E).find(".loader").show(),r=d[w].indexed[n][u].data,o=d[w].indexed[n][u].isExternal,e(E).find(".hf-content-box").scrollTop(0),o==0?function(){var t=e("<div/>").html(r);q(t)}():function(){e.get(r,function(e){var t="<body>",n="</body>",r=e.search(t),i=e.search(n),s=e.substring(r+t.length,i);q(s)},"html")}()}function q(t){var n=e("<div/>").html(t),i=0,s="",o="",u="",a="",f="";r.autolinking==1&&(R(e(n)),e(n).find("span.textnode").each(function(){var t=e(this).parents("a").length,n=e(this).parents("pre").length,r=e(this).parents("code").length;if(t==0&&n==0&&r==0){var l=e(this).text(),c=0,h=0;for(;c<d[w].allCategories.length;c++){str=d[w].allCategories[c];var p=l.match(new RegExp(str,"gi")),m=0;if(p)for(;m<p.length;m++){var g=l.search(new RegExp(str,"gi"));s=l.substr(g,str.length),o=l.substr(g-1,1),u=l.substr(g+str.length,1),a=o.match(/[^,\s]/g),f=u.match(/[^,.\s]/g),a==null&&f==null&&(l=l.replace(new RegExp(s,"i"),"wrd-"+i+c+m),v[0].push("wrd-"+i+c+m),v[1].push('<a href="javascript:void(0)" class="mapped" title="'+s+'" ui:target="cat-'+d[w].allCategoriesId[c]+'">'+s+"</a>"))}for(;h<v[0].length;h++)l=l.replace(new RegExp(v[0][h],"i"),v[1][h]);i++}e(this).html(l)}})),e(E).find(".hf-content").html(e(n).html()),e(n).remove(),e(E).find(".loader").hide(),z(),e(E).find(".mapped").click(U)}function R(t){t.find("*").each(function(){e(this).contents().filter(function(){return this.nodeType==3}).wrap('<span class="textnode"/>')}),t.contents().filter(function(){return this.nodeType==3}).wrap('<span class="textnode"/>'),t.find("span.textnode").filter(function(){return e.trim(e(this).text())===""&&e(this).children().length==0}).remove()}function U(){var t=e(this).attr("ui:target");e(E).find("a."+t).trigger("click")}function z(){e(E).find(".hf-content").find("a").each(function(){e(this).hasClass("mapped")==0&&e(this).attr("target","_blank")})}function W(){e(E).find(".hf-search-fld").autosuggest({data:d[w].allCategories,onSelect:function(t){var n=t.item.text(),r=jQuery.inArray(n,d[w].allCategories),i=d[w].allCategoriesId[r],s=e(E).find(".cat-tabs").find("li.act").find("a").attr("class");s=="contents-tab"?e(E).find(".cats").find(".cat-"+i).trigger("click").parents("ul").css({display:"block"}):s=="index-tab"?e(E).find(".cats-idx").find(".idx-"+i).trigger("click"):""}})}function X(t){var n=t.keyCode||t.charCode,r=27,i=37,s=39,u=e(E).find("input:focus").length;if(o==1&&u==0)switch(n){case r:C();break;case i:e(E).find(".prev-pg").trigger("click");break;case s:e(E).find(".next-pg").trigger("click")}}function V(e){var t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n="";for(i=0;i<e;i++){var r=Math.floor(Math.random()*t.length);n+=t.substring(r,r+1)}return n}function J(){}var n={url:"",width:700,height:500,autolinking:!1,title:"Help",footer:"&copy; Impetus Infotech (India) 2012",theme:"default",onComplete:J},r=e.extend({},n,t),s,o=!1,u,a="",f,l,c,h,p,d={},v=[[],[]],m,g,y={},b=!0,w=V(6),E=e("<div/>").attr("id","hf"+w).css({display:"none"});d[w]=new Object,d[w]={indexed:{},allCategories:[],allCategoriesId:[]},y[w]=new Array,r.width=parseInt(r.width),r.height=parseInt(r.height),s='<div class="help-wrap"><div class="hf-title"><h1></h1></div><div class="hf-action-bar"><div class="left-pane"><div class="left-box"><input type="text" value="" class="hf-search-fld" placeholder="Search" /></div></div><div class="right-pane"><div class="right-box"><div class="history"></div><div class="pg-title"><h3></h3></div><div class="toolbar"><a href="javascript:void(0)" class="prev-pg" title="Previous">Prev</a><a href="javascript:void(0)" class="next-pg" title="Next">Next</a></div></div></div></div><div class="hf-content-pane"><div class="left-pane hf-cat-box"><ul class="hftab cat-tabs"><li><a href="javascript:void(0)" class="contents-tab" ui:target=".hf-category">Contents</a></li><li><a href="javascript:void(0)" class="index-tab" ui:target=".hf-category-index">Index</a></li></ul><div class="hf-category-pane hftab-content"><div class="left-box hf-category"></div><div class="left-box hf-category-index"></div></div></div><div class="right-pane hf-content-box"><div class="loader"></div><div class="right-box hf-content"></div></div></div><div class="hf-footer-bar"></div></div>',this.click(N),this.initHelpFramework=function(t){f=e(window).width(),l=e(window).height(),c=(f-t.width)/2,h=(l-t.height)/2,t.url?e.ajax({url:t.url,dataType:"json",complete:function(n){n.status=="404"?alert("JSON not found!"):function(){u=jQuery.parseJSON(n.responseText),p="theme-"+t.theme.toLowerCase(),S(),x(u),T(),A(u.topics),M(),D(),e(E).find(".cats a").click(H),e(E).find(".cats li:first a:first").trigger("click"),e(E).find("a.prev-pg, a.next-pg").click(j),e(E).find("a.back-pg").click(function(){F("back-pg")}),e(E).find("a.forward-pg").click(function(){F("forward-pg")}),W(),e(document).keydown(function(e){X(e)}),t.onComplete&&t.onComplete()}()}}):alert("Please enter JSON url in plugin configuration!")},this.initHelpFramework(r)},helptt:function(t){function y(t){function k(){d.cur=n.left+i/2-u+20,d.act=d.cur,v.cur=n.top-a-c-10,v.act=v.cur+10,h="tip-lt",autoTT=!1}function L(){d.cur=n.left+i/2-u/2,d.act=d.cur,v.cur=n.top-a-c-10,v.act=v.cur+10,h="tip-t",autoTT=!1}function A(){d.cur=n.left+i/2-20,d.act=d.cur,v.cur=n.top-a-c-10,v.act=v.cur+10,h="tip-rt",autoTT=!1}function O(){d.cur=n.left-u-c-10,d.act=d.cur+10,v.cur=n.top+y/2-a/2,v.act=v.cur,h="tip-l",autoTT=!1}function M(){d.cur=n.left+i+c+10,d.act=d.cur-10,v.cur=n.top+y/2-a/2,v.act=v.cur,h="tip-r",autoTT=!1}function _(){d.cur=n.left+i/2-u+20,d.act=d.cur,v.cur=n.top+y+c+10,v.act=v.cur-10,h="tip-lb",autoTT=!1}function D(){d.cur=n.left+i/2-u/2,d.act=d.cur,v.cur=n.top+y+c+10,v.act=v.cur-10,h="tip-b",autoTT=!1}function P(){d.cur=n.left+i/2-20,d.act=d.cur,v.cur=n.top+y+c+10,v.act=v.cur-10,h="tip-rb",autoTT=!1}b();var n=e(this).offset(),i=e(this).outerWidth(),y=e(this).outerHeight(),w=e(window).scrollTop(),E=e(this).attr("keyword"),S=e(this).attr("config");typeof S!="undefined"&&(S=e.parseJSON(S.replace(/\'/g,'"')),S.w&&(r.width=S.w),S.h&&(r.height=S.h),S.dir&&(r.direction=S.dir),S.dur&&(r.duration=S.dur),S.theme&&(r.theme=S.theme)),p="theme-"+r.theme;var x=e("<div/>").attr("id","helpTTWrap").attr("class","help-tt-wrap "+p).appendTo("body");f=e(x).outerWidth(),l=e(x).outerHeight();var T=e("<div/>").attr("class","help-tt-content").appendTo(x),N=0;r.trigger=="click"?function(){var t=e("<div/>").attr("class","help-tt-close").append('<a href="javascript:void(0)"/>').click(b).appendTo(x);N=e(t).outerWidth()}():N=0,keywords[E]==""||typeof keywords[E]=="undefined"?e(T).html("<font color='#f00'>No data found!</font>"):e(T).html(keywords[E]),r.duration=parseInt(r.duration);var C=e(x).outerWidth();u=r.width=="auto"&&C>300?150+f:r.width=="auto"&&C<300?C:parseInt(r.width)+f,e(T).css({width:u-f-N+"px"}),a=r.height=="auto"?e(x).height()+l:parseInt(r.height)+l,e(T).css({height:a-l+"px"}),m.left=n.left-u,m.right=s-(n.left+i+u),m.top=n.top-a-w,m.bottom=o-(n.top+y+a)+w,m.centerLeft=n.left+i/2,m.centerRight=s-(n.left+i/2),m.midTop=n.top+y/2-w,m.midBot=o-(n.top+y/2)+w,g.left=m.left>0?!0:!1,g.right=m.right>0?!0:!1,g.top=m.top>0?!0:!1,g.bottom=m.bottom>0?!0:!1,g.center=m.centerLeft>u/2&&m.centerRight>u/2?!0:!1,g.mid=m.midTop>a/2&&m.midBot>a/2?!0:!1,dir=r.direction.toUpperCase();switch(dir){case"TL":g.left==1&&g.top==1?k():autoTT=!0;break;case"T":g.top==1&&g.center==1?L():autoTT=!0;break;case"TR":g.right==1&&g.top==1?A():autoTT=!0;break;case"L":g.left==1&&g.mid==1?O():autoTT=!0;break;case"R":g.right==1&&g.mid==1?M():autoTT=!0;break;case"BL":g.left==1&&g.bottom==1?_():autoTT=!0;break;case"B":g.bottom==1&&g.center==1?D():autoTT=!0;break;case"BR":g.right==1&&g.bottom==1?P():autoTT=!0;break;default:autoTT=!0}autoTT==1&&(g.left==0&&g.right==1&&g.mid==1?M():g.left==1&&g.right==0&&g.mid==1?O():g.center==1&&g.top==0&&g.bottom==1?D():g.center==1&&g.top==1&&g.bottom==0?L():g.left==0&&g.right==1&&g.top==0&&g.bottom==1?P():g.left==1&&g.right==0&&g.top==0&&g.bottom==1?_():g.left==0&&g.right==1&&g.top==1&&g.bottom==0?A():g.left==1&&g.right==0&&g.top==1&&g.bottom==0?k():function(){L()}()),e(x).stop().delay(300).css({left:d.cur,top:v.cur,opacity:0}).append('<div class="tip '+h+'"></div>').animate({left:d.act,top:v.act,opacity:1},{queue:!0,duration:r.duration})}function b(){e("#helpTTWrap").remove()}var n={width:"auto",height:"auto",direction:"",theme:"default",trigger:"hover",duration:300},r=e.extend({},n,t),i=this,s,o,u,a,f,l,c=10,h,p,d={cur:0,act:0},v={cur:0,act:0},m={left:0,right:0,top:0,bottom:0,centerLeft:0,centerRight:0,midTop:0,midBot:0},g={left:!1,right:!1,top:!1,bottom:!1,center:!1,mid:!1};this.initHelpTooltip=function(t){s=e(window).width(),o=e(window).height(),t.trigger=="click"?function(){i.click(y)}():t.trigger=="focus"?function(){i.focus(y),i.blur(b)}():function(){i.mouseenter(y),i.mouseleave(b)}()},this.initHelpTooltip(r)},autosuggest:function(t){function m(){p=e("<div/>").attr("class","auto-suggest").appendTo(r.appendTo),e(v).keyup(function(t){var n=e(this).val(),r=t.which;switch(r){case u:return S(),!1;case l:case c:return!1;case a:return y(r),!1;case f:return y(r),!1;case s:return x(),!1;case o:return e(d).children().size()>0&&x(),!1;default:g(n)}}),e(v).blur(function(){x()})}function g(t){S();var n=e(v).offset(),s=e(v).outerWidth(),o=e(v).outerHeight();e(p).css({width:s,left:n.left,top:o+n.top}),d=e("<ul/>").appendTo(p),i=[];if(t.length>0){for(var u=0;u<r.data.length;u++)r.data[u].substr(0,t.length).toLowerCase()==t.toLowerCase()&&i.push(r.data[u]);if(i.length>0){var a=0;for(;a<i.length;a++)e("<li/>").html(i[a]).appendTo(d);e('<li style="display:none;"/>').html(t).appendTo(d),e(p).css({display:"block"})}else e('<li style="display:none;"/>').html(t).appendTo(d);d.find("li").hover(function(){d.find("li").removeClass("highlight"),e(this).addClass("highlight")},function(){d.find("li").removeClass("highlight")}),d.find("li").click(function(){e(v).val(e(this).text()),x()})}}function y(t){if(!d)return!1;var n;t==f?n=h+1:t==a?n=h-1:"",n>e(d).children().size()&&(n=1),n<1&&(n=e(d).children().size()),b(n)}function b(t){if(!d)return!1;h>0&&w(),h=Number(t);var n=e(d).children().get(h-1);n.className="highlight",e(v).val(n.innerHTML),E(n)}function w(){if(!d)return!1;h>0&&(e(d).children().get(h-1).className="",h=0)}function E(t){if(!d)return!1;var n=p.height(),r=p.scrollHeight,i=e(p).scrollTop(),s=t.offsetTop,o=s+t.offsetHeight;return o>i+n?e(p).scrollTop(o-n):s<i?e(p).scrollTop(s):"",!0}function S(){w(),e(p).css({display:"none"}),e(d).remove(),d=null}function x(){e(v).val(e(d).find("li.highlight").text());var t={item:e(d).find("li.highlight")};r.onSelect.call("select",t),S()}var n={data:[],appendTo:"body",onSelect:null},r=e.extend({},n,t),i=[],s=13,o=9,u=27,a=38,f=40,l=37,c=39,h=0,p,d=null,v=this;m()}})})(jQuery);
